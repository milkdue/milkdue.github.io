function flatComments(e){let a=[];return e.forEach((e=>{a.push(e),e.replies.length&&a.push(...flatComments(e.replies))})),a}function popCommentBarrage(e){let a=document.createElement("div");a.className="comment-barrage-item",a.innerHTML=`\n        <div class="barrageHead">\n            <div class="barrageTitle">热评</div>\n            <div class="barrageNick">${e.nick}</div>\n            <img class="barrageAvatar" src="${e.avatar}">\n            <a class="comment-barrage-close" href="javascript:closeCommentBarrage()"><i\n                    class="fa-solid fa-xmark"></i></a>\n        </div>\n        <div class="barrageContent">\n            ${e.comment}\n        </div>\n    `,commentBarrageConfig.barrageTimer.push(a),commentBarrageConfig.dom.append(a)}function removeCommentBarrage(e){e.className="comment-barrage-item out",setTimeout((function(){commentBarrageConfig.dom.removeChild(e)}),200)}function initCommentBarrage(){clearInterval(commentInterval),commentInterval=null,commentInterval=setInterval((()=>{commentBarrageConfig.barrageList.length&&!hoverOnCommentBarrage&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length,commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift()))}),commentBarrageConfig.barrageTime)}async function initComment(){getComments().then((e=>{commentBarrageConfig.barrageList=flatComments(e.data),commentBarrageConfig.barrageList.length&&initCommentBarrage()}))}async function getComments(){return(await fetch(commentBarrageConfig.twikooUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"COMMENT_GET",url:commentBarrageConfig.pageUrl})})).json()}var commentNode=document.createElement("div");commentNode.className="comment-barrage",document.getElementById("footer").appendChild(commentNode);var commentBarrageConfig={maxBarrage:1,barrageTime:4e3,twikooUrl:"https://twikoo.keyiqingxin.cn/",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:commentNode},commentInterval=null,hoverOnCommentBarrage=!1;function closeCommentBarrage(){clearInterval(commentInterval),commentBarrageConfig.dom.innerHTML=""}initComment(),$(".comment-barrage").hover((function(){hoverOnCommentBarrage=!0}),(function(){hoverOnCommentBarrage=!1}));